<!DOCTYPE html>
<html>
<head>
    <title>Login Test</title>
</head>
<body>
    <h1>Test strony</h1>

    <form id="loginForm">
        <input type="email" id="email" placeholder="Email" value="admin@example.com"><br><br>
        <input type="password" id="password" placeholder="Has≈Ço" value="admin123"><br><br>
        <button type="submit" id="loginBtn">Zaloguj</button>
    </form>

    <div id="errorMsg" style="color: red; display: none;">
        <span id="errorText"></span>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        console.log('üöÄ SKRYPT URUCHOMIONY!');

        // Inicjalizuj Supabase
        const supabase = supabase.createClient(
            'https://xsowdwnpguftmlvsogdb.supabase.co',
            'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inhzb3dkd25wZ3VmdG1sdnNvZ2RiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU3NTc0MzQsImV4cCI6MjA3MTMzMzQzNH0.yFz01fJCqTuaY-jzgqlcgueiU4Id71t66xtjhAGXNWI'
        );

        console.log('üì¶ Supabase:', supabase ? 'OK' : 'B≈ÅƒÑD');

        window.login = async function() {
            console.log('üîÑ LOGIN FUNKCJA WYWO≈ÅANA!');

            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            console.log('üìß EMAIL:', email);
            console.log('üîë HAS≈ÅO:', password ? 'WPROWADZONE' : 'PUSTE');

            try {
                console.log('üîê ≈ÅƒÑCZENIE Z SUPABASE...');
                const { data, error } = await supabase.auth.signInWithPassword({
                    email: email,
                    password: password
                });

                console.log('üìä WYNIK:', data ? 'SUKCES' : 'B≈ÅƒÑD');
                console.log('‚ùå B≈ÅƒÑD:', error ? error.message : 'BRAK');

                if (error) {
                    document.getElementById('errorText').textContent = 'B≈ÅƒÑD: ' + error.message;
                    document.getElementById('errorMsg').style.display = 'block';
                    return;
                }

                console.log('‚úÖ ZALOGOWANY JAKO:', data.user.email);

                // Sprawd≈∫ rolƒô
                const { data: profile } = await supabase
                    .from('profiles')
                    .select('role')
                    .eq('id', data.user.id)
                    .single();

                console.log('üë§ ROLA:', profile ? profile.role : 'BRAK PROFILU');

                if (profile && (profile.role === 'admin' || profile.role === 'trainer')) {
                    console.log('üéØ PRZEKIEROWANIE DO admin.html');
                    window.location.href = 'admin.html';
                } else {
                    console.log('‚ùå BRAK UPRAWNIE≈É');
                    document.getElementById('errorText').textContent = 'BRAK UPRAWNIE≈É';
                    document.getElementById('errorMsg').style.display = 'block';
                }

            } catch (err) {
                console.error('üí• B≈ÅƒÑD:', err.message);
                document.getElementById('errorText').textContent = 'B≈ÅƒÑD: ' + err.message;
                document.getElementById('errorMsg').style.display = 'block';
            }
        };

        // Pod≈ÇƒÖcz event listener
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üìÑ DOM ZA≈ÅADOWANY');

            const form = document.getElementById('loginForm');
            if (form) {
                form.addEventListener('submit', function(e) {
                    e.preventDefault();
                    console.log('üö´ FORMULARZ ZATRZYMANY');
                    window.login();
                });
                console.log('‚úÖ EVENT LISTENER POD≈ÅƒÑCZONY');
            } else {
                console.log('‚ùå FORMULARZ NIE ZNALEZIONY');
            }
        });

        console.log('üèÅ KONIEC SKRYPTU');
    </script>
</body>
</html>
